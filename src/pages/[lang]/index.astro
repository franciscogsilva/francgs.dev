---
import { getCollection } from "astro:content";
import PostCard from "../../components/PostCard.astro";
import data from "../../data/site.json";
import BaseLayout from "../../layouts/BaseLayout.astro";
import { sortPostsByPubDateDesc } from "../../utils/sortPosts";

export const prerender = true;
const POSTS_PER_PAGE = 20;

export async function getStaticPaths() {
  return [
    { params: { lang: "en" }, props: { lang: "en" } },
    { params: { lang: "es" }, props: { lang: "es" } },
  ];
}

const { lang } = Astro.props as { lang: "en" | "es" };

const allPosts = sortPostsByPubDateDesc(
  await getCollection("blog", ({ data }) => !data.draft && data.lang === lang)
);

const currentPage = 1;
const totalPages = Math.max(1, Math.ceil(allPosts.length / POSTS_PER_PAGE));
const posts = allPosts.slice(0, POSTS_PER_PAGE);
const nextPageHref = totalPages > 1 ? `/${lang}/page/2/` : null;

const copy =
  lang === "es"
    ? {
        title: data.siteTitle,
        subtitleStart:
          "Resuelvo problemas, a veces con codigo, siempre con cafe â˜•ï¸. Tech Lead y Sr. Software Developer con",
        yearsLabel: "+9 anos de experiencia",
        about: "mas informacion sobre mi",
        links: "algunos magic links",
      }
    : {
        title: data.siteTitle,
        subtitleStart:
          "I solve problems, sometimes with code, always with coffee â˜•ï¸. Tech Lead & Sr. Software Developer with",
        yearsLabel: "+9 years of experience",
        about: "more information about me",
        links: "some magic links",
      };
---

<BaseLayout title={copy.title} description={data.siteDescription} lang={lang}>
  <section class="pt-12 pb-8 space-y-2 sm:space-y-5 md:space-y-4 md:w-[550px]">
    <h1
      class="text-4xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:leading-10 md:leading-14"
    >
      Hey, I'm
      <a class="hover-underline-animation text-primary" href="/about"
        >{data.nickName}</a
      >
      <span class="wave" role="img" aria-label="Hello"> ğŸ‘‹ğŸ½</span>
    </h1>
    <h2 class="text-lg font-extralight text-gray-600 dark:text-gray-400 pt-1">
      {copy.subtitleStart}
      <strong class="text-secondary"> {copy.yearsLabel}</strong>.
    </h2>
    <p class="font-thin text-gray-600 dark:text-gray-400 pt-0.5">
      Here is
      <a
        target="_blank"
        href="/about"
        class="icon-link hover-underline-animation font-medium inline-flex flex-row items-center gap-2"
      >
        {copy.about}
      </a>
      ğŸ’¡. I also have
      <a
        target="_blank"
        href="/links"
        class="icon-link hover-underline-animation font-medium inline-flex flex-row items-center gap-2"
      >
        {copy.links}
      </a>
      ğŸ”®.
    </p>
  </section>
  <div class="grid grid-cols-1 gap-6 mt-12">
    {
      posts.map((post) => (
        <PostCard
          pubDate={post.data.pubDate.toISOString()}
          url={`/${lang}/blog/${post.id}`}
          title={post.data.title}
          tags={post.data.tags}
          description={post.data.description}
        />
      ))
    }
  </div>

  {
    totalPages > 1 && (
      <nav class="mt-10 mb-14 flex items-center justify-between gap-4" aria-label="Pagination">
        <span class="text-sm text-gray-600 dark:text-gray-400">
          {lang === "es"
            ? `Pagina ${currentPage} de ${totalPages}`
            : `Page ${currentPage} of ${totalPages}`}
        </span>

        <a
          href={nextPageHref!}
          class="inline-flex items-center rounded-lg border border-gray-300 px-4 py-2 text-sm font-medium text-gray-800 transition hover:border-gray-400 hover:bg-gray-50 dark:border-gray-700 dark:text-gray-100 dark:hover:border-gray-500 dark:hover:bg-gray-800"
        >
          {lang === "es" ? "Siguiente" : "Next"}
        </a>
      </nav>
    )
  }
</BaseLayout>
