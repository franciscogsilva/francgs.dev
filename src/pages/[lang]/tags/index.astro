---
import { getCollection } from "astro:content";
import BaseLayout from "../../../layouts/BaseLayout.astro";

export const prerender = true;

export async function getStaticPaths() {
  return [
    { params: { lang: "en" }, props: { lang: "en" } },
    { params: { lang: "es" }, props: { lang: "es" } },
  ];
}

const { lang } = Astro.props as { lang: "en" | "es" };

const title = lang === "es" ? "Etiquetas" : "Tags";

const allPosts = await getCollection(
  "blog",
  ({ data }) => !data.draft && data.lang === lang
);

const uniqueTags = [
  ...new Set(allPosts.map((post) => post.data.tags).flat()),
].sort();

const description =
  lang === "es"
    ? "Explora temas y categorias del blog en espanol."
    : "Browse all blog topics and categories in English.";
---

<BaseLayout title={title} description={description} lang={lang}>
  <div class="max-w-4xl mx-auto mt-12">
    <div class="text-center mb-12">
      <h1
        class="text-4xl md:text-5xl font-bold text-gray-900 dark:text-gray-100 mb-4"
      >
        {title}
      </h1>
      <p class="text-gray-600 dark:text-gray-400">
        {lang === "es" ? "Explora todos los temas" : "Explore all topics"}
      </p>
    </div>

    <div class="flex flex-wrap justify-center gap-3">
      {
        uniqueTags.map((tag) => {
          const count = allPosts.filter((post) => post.data.tags?.includes(tag)).length;
          return (
            <a
              href={`/${lang}/tags/${tag}`}
              class="group flex items-center gap-2 px-4 py-2 rounded-full bg-gray-100 dark:bg-gray-800/50 border border-gray-200 dark:border-gray-700 hover:border-secondary/50 hover:bg-secondary/5 hover:text-secondary transition-all duration-300 ease-out"
            >
              <span class="text-sm font-medium text-gray-700 dark:text-gray-200 group-hover:text-secondary uppercase tracking-wide">
                {tag}
              </span>
              <span class="flex items-center justify-center h-5 min-w-[1.25rem] px-1.5 rounded-full bg-gray-200 dark:bg-gray-700 text-[10px] font-bold text-gray-600 dark:text-gray-300 group-hover:bg-secondary/20 group-hover:text-secondary transition-colors">
                {count}
              </span>
            </a>
          );
        })
      }
    </div>
  </div>
</BaseLayout>
